{{
  config(
    materialized='incremental',
    incremental_strategy='merge',
	  unique_key=dbt_utils.surrogate_key(['KOKRS','KOSTL','DATETO'])
  )
}}

WITH DIM_COSTCENTER_STG AS (
SELECT
	CCA.KOKRS,
	CCA.KOSTL,
	CCA.DATETO,

	NVL(CCT.LANGU,'') AS LANGU,

	CCA.DATEFROM,
	CCA.VERAK,
	CCA.BUKRS,
	CCA.GSBER,
	CCA.KOSAR,
	CCA.WAERS,
	CCA.PRCTR,
	CCA.BKZKP,
	CCA.PKZKP,
	CCA.VERAK_USER,
	CCA.KALSM,
	CCA.TXJCD,
	CCA.WERKS,
	CCA.LOGSYSTEM,
	CCA.ERSDA,
	CCA.USNAM,
	CCA.BKZKS,
	CCA.BKZER,
	CCA.BKZOB,
	CCA.PKZKS,
	CCA.PKZER,
	CCA.VMETH,
	CCA.MGEFL,
	CCA.ABTEI,
	CCA.NKOST,
	CCA.KVEWE,
	CCA.KAPPL,
	CCA.KOSZSCHL,
	CCA.LAND1,
	CCA.ANRED,
	CCA.NAME1,
	CCA.NAME2,
	CCA.NAME3,
	CCA.NAME4,
	CCA.ORT01,
	CCA.ORT02,
	CCA.STRAS,
	CCA.PFACH,
	CCA.PSTLZ,
	CCA.PSTL2,
	CCA.REGIO,
	CCA.SPRAS,
	CCA.TELBX,
	CCA.TELF1,
	CCA.TELF2,
	CCA.TELFX,
	CCA.TELTX,
	CCA.TELX1,
	CCA.DATLT,
	CCA.DRNAM,
	CCA.KHINR,
	CCA.CCKEY,
	CCA.KOMPL,
	CCA.STAKZ,
	CCA.OBJNR,
	CCA.FUNKT,
	CCA.AFUNK,
	CCA.CPI_TEMPL,
	CCA.CPD_TEMPL,
	CCA.FUNC_AREA,
	CCA.SCI_TEMPL,
	CCA.SCD_TEMPL,
	CCA.VNAME,
	CCA.RECID,
	CCA.ETYPE,
	CCA.JV_OTYPE,
	CCA.JV_JIBCL,
	CCA.JV_JIBSA,

	CCT.TXTSH,
	CCT.TXTMD,
	CCT.TXTMC

FROM ARRAY_DB.ARRAY_DB_EDW.COSTCENTER_ATTR CCA 
LEFT OUTER JOIN ARRAY_DB.ARRAY_DB_EDW.COSTCENTER_TEXT CCT 
ON (CCA.KOKRS=CCT.KOKRS and CCA.KOSTL=CCT.KOSTL and CCA.DATETO=CCT.DATETO)
),

DIM_COSTCENTER AS (
SELECT
	KOKRS,
	KOSTL,
	DATETO,

	LANGU,

	DATEFROM,
	VERAK,
	BUKRS,
	GSBER,
	KOSAR,
	WAERS,
	PRCTR,
	BKZKP,
	PKZKP,
	VERAK_USER,
	KALSM,
	TXJCD,
	WERKS,
	LOGSYSTEM,
	ERSDA,
	USNAM,
	BKZKS,
	BKZER,
	BKZOB,
	PKZKS,
	PKZER,
	VMETH,
	MGEFL,
	ABTEI,
	NKOST,
	KVEWE,
	KAPPL,
	KOSZSCHL,
	LAND1,
	ANRED,
	NAME1,
	NAME2,
	NAME3,
	NAME4,
	ORT01,
	ORT02,
	STRAS,
	PFACH,
	PSTLZ,
	PSTL2,
	REGIO,
	SPRAS,
	TELBX,
	TELF1,
	TELF2,
	TELFX,
	TELTX,
	TELX1,
	DATLT,
	DRNAM,
	KHINR,
	CCKEY,
	KOMPL,
	STAKZ,
	OBJNR,
	FUNKT,
	AFUNK,
	CPI_TEMPL,
	CPD_TEMPL,
	FUNC_AREA,
	SCI_TEMPL,
	SCD_TEMPL,
	VNAME,
	RECID,
	ETYPE,
	JV_OTYPE,
	JV_JIBCL,
	JV_JIBSA,

	TXTSH,
	TXTMD,
	TXTMC

FROM DIM_COSTCENTER_STG
)

select * from DIM_COSTCENTER